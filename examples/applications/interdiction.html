
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>TODO &#8212; CVXPY 1.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/cvxpy_alabaster.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="todo">
<h1>TODO<a class="headerlink" href="#todo" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>time-varying graphs</p></li>
<li><p>table of results</p></li>
<li><p>show combinatorics. why not NP hard. enumerate paths.</p></li>
<li><p>remove <span class="math notranslate nohighlight">\(\mathcal{P}\)</span>. just describe a path with <span class="math notranslate nohighlight">\(x\)</span> from
the start?</p></li>
</ul>
</section>
<section id="topic-references">
<h1>Topic references<a class="headerlink" href="#topic-references" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="http://web.stanford.edu/~boyd/cvxbook/">Convex Optimization book</a></p></li>
<li><p><a class="reference external" href="http://web.stanford.edu/~boyd/cvxbook/bv_cvxbook_extra_exercises.pdf">Additional Exercise 15.4: Allocation of interdiction
effort</a></p></li>
<li><p><a class="reference external" href="http://en.wikipedia.org/wiki/Shortest_path_problem">Shortest path problem in graph
theory</a></p></li>
<li><p><a class="reference external" href="http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm">Dijkstra’s_algorithm</a></p></li>
<li><p><cite>Iterated weighted :math:</cite>ell_1`
heuristic &lt;<a class="reference external" href="http://stanford.edu/class/ee364b/lectures/l1_ext_slides.pdf">http://stanford.edu/class/ee364b/lectures/l1_ext_slides.pdf</a>&gt;`__</p></li>
</ul>
</section>
<section id="allocating-interdiction-effort-to-catch-a-smuggler">
<h1>Allocating interdiction effort to catch a smuggler<a class="headerlink" href="#allocating-interdiction-effort-to-catch-a-smuggler" title="Permalink to this headline">¶</a></h1>
<p>We’ll explore a game between a smuggler moving through a graph and a
security team trying to catch him.</p>
<p>The smuggler moves along a directed graph (cycles are allowed) with
<span class="math notranslate nohighlight">\(n\)</span> nodes and <span class="math notranslate nohighlight">\(m\)</span> edges from node <span class="math notranslate nohighlight">\(0\)</span> (the source) to
node <span class="math notranslate nohighlight">\(n-1\)</span> (the destination). Edge <span class="math notranslate nohighlight">\(j\)</span> has evasion
probability <span class="math notranslate nohighlight">\(p_j\)</span>, which is the probability that the smuggler
moves along that edge undetected. The detection events on the edges are
independent, so the probability that the smuggler makes it to the
destination undetected is <span class="math notranslate nohighlight">\(\prod_{j \in \mathcal{P}} p_j\)</span>, where
<span class="math notranslate nohighlight">\(\mathcal{P} \subset \lbrace 0,\ldots, m-1\rbrace\)</span> is the set of
edges on the smuggler’s path. We assume that the smuggler knows the
evasion probabilities and will take a path that maximizes the
probability of making it to the destination node undetected.</p>
<p>The security team is trying to catch the smuggler as he moves through
the graph. They can control the evasion probabilities on the graph edges
through, say, allocation of resources to the edges, assigning guards,
etc. We’ll keep this abstract for now, and just consider that security
can modify the evasion probabilities subject to some constraints. Their
goal is to choose evasion probabilities to minimize the chance that the
smuggler gets through undetected.</p>
</section>
<section id="transformations-and-mathematical-formulation">
<h1>Transformations and mathematical formulation<a class="headerlink" href="#transformations-and-mathematical-formulation" title="Permalink to this headline">¶</a></h1>
<p>We’ll take the logarithm of all probabilities to make the problem
amenable to convex optimization and simplify the remaining discussion.
This transforms products of variables (generally not convex) into sums
of variables (convex!).</p>
<p>Let <span class="math notranslate nohighlight">\(c_j = \log(p_j)\)</span>. As this is a one-to-one correspondence, we
may refer to the ‘edge detection probabilities’ when we really mean to
refer to their logarithm, <span class="math notranslate nohighlight">\(c\)</span>. This should be clear from context
and hopefully won’t cause any confusion.</p>
<p>Given <span class="math notranslate nohighlight">\(c\)</span> and a path <span class="math notranslate nohighlight">\(\mathcal{P}\)</span>, let
<span class="math notranslate nohighlight">\(P(c, \mathcal{P})\)</span> be the logarithm of the evasion probability of
that path. That is,</p>
<div class="math notranslate nohighlight">
\[P(c, \mathcal{P}) = \log \left( \prod_{j \in \mathcal{P}} p_j \right) = \sum_{j \in \mathcal{P}} \log(p_j) = \sum_{j \in \mathcal{P}} c_j.\]</div>
<p>Define <span class="math notranslate nohighlight">\(P(c, \mathcal{P}) = -\infty\)</span> if <span class="math notranslate nohighlight">\(\mathcal{P}\)</span> is not
a valid path from source to sink. We do this to implicitly encode the
constraint that the smuggler’s path must be valid.</p>
</section>
<section id="min-max-game">
<h1>Min/max game<a class="headerlink" href="#min-max-game" title="Permalink to this headline">¶</a></h1>
<p>We can now interpret this problem as a min/max game. The smuggler is
trying to maximize his chance of getting through undetected by choosing
<span class="math notranslate nohighlight">\(\mathcal{P}\)</span>, and security is trying to minimize the smuggler’s
chance by choosing <span class="math notranslate nohighlight">\(c\)</span>. That is, the smuggler is trying to
maximize <span class="math notranslate nohighlight">\(P(c, \mathcal{P})\)</span> while the security team is trying to
minimize it.</p>
<p>We end up with a game with two ‘moves’. Security ‘moves’ first by
choosing the edge evasion probabilities via <span class="math notranslate nohighlight">\(c\)</span>. The smuggler
‘moves’ second (after <span class="math notranslate nohighlight">\(c\)</span> is fixed) by choosing his path
<span class="math notranslate nohighlight">\(\mathcal{P}\)</span>.</p>
<p>For security to make an optimal choice of edge evasion probabilities,
they’ll need to model what the smuggler will do when faced with any set
of evasion probabilities. Thus, we’ll let <span class="math notranslate nohighlight">\(P^\mathrm{opt}(c)\)</span> be
the optimal value of the problem</p>
<p>\[ ]</p>
<p><span class="math notranslate nohighlight">\(P^\mathrm{opt}(c)\)</span> is the (logarithm of the) evasion probability
of the smuggler if he picks an optimal path, knowing the values of
<span class="math notranslate nohighlight">\(c\)</span>.</p>
<p>The security team’s goal is then to minimize this quantity, subject to
some constraints on <span class="math notranslate nohighlight">\(c\)</span>, which we’ll denote by the set
<span class="math notranslate nohighlight">\(\mathcal{C}\)</span>. Let <span class="math notranslate nohighlight">\(P^{\star}\)</span> be the optimal value of</p>
<p>\[ ]</p>
<p>In the remainder, we’ll first consider the smuggler’s objective so as to
obtain a convex formulation of <span class="math notranslate nohighlight">\(P^\mathrm{opt}(c)\)</span>, which we can
then use to analyze and optimize the security team’s objective.</p>
</section>
<section id="helper-functions">
<h1>Helper functions<a class="headerlink" href="#helper-functions" title="Permalink to this headline">¶</a></h1>
<p>The next cell contains some helper functions for generating the examples
and plotting the results. This is the majority of the code. The actual
CVXPY optimization code is only a few lines. We’ll go over the
optimization code later in the notebook.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#%config InlineBackend.figure_format = &#39;pdf&#39;</span>
<span class="c1">#%config InlineBackend.figure_format = &#39;svg&#39;</span>
<span class="o">%</span><span class="n">config</span> <span class="n">InlineBackend</span><span class="o">.</span><span class="n">figure_format</span> <span class="o">=</span> <span class="s1">&#39;retina&#39;</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">import</span> <span class="nn">cvxpy</span> <span class="k">as</span> <span class="nn">cp</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;font.size&#39;</span><span class="p">:</span> <span class="mi">16</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">formGraph</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">mu</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">buildings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Form N by N grid of nodes, perturb by mu and connect nodes within eta.</span>
<span class="sd">        mu and eta are relative to 1/(N-1)</span>

<span class="sd">        buildings is a list of tuples (x,y,w,h)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="n">mu</span> <span class="o">=</span> <span class="n">mu</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="n">eta</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># generate perterbed grid positions for the nodes</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span> <span class="o">+</span> <span class="n">mu</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(),</span> <span class="n">j</span> <span class="o">+</span> <span class="n">mu</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">())</span>\
       <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">N</span><span class="p">)]</span>

    <span class="c1">#select out nodes that end up inside buildings</span>
    <span class="k">if</span> <span class="n">buildings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">buildings</span> <span class="o">!=</span> <span class="p">[]:</span>
        <span class="n">pos2</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">:</span>
            <span class="n">inside</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">w</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">h</span><span class="p">:</span>
                    <span class="n">inside</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">inside</span><span class="p">:</span>
                <span class="n">pos2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos2</span>

    <span class="c1"># add dummy nodes for multiple entry/exit example</span>
    <span class="k">if</span> <span class="n">dummyNodes</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">)]</span> <span class="o">+</span> <span class="n">pos</span> <span class="o">+</span> <span class="p">[(</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">.5</span><span class="p">)]</span>

    <span class="n">pos</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">pos</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

    <span class="c1"># connect nodes with edges</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">random_geometric_graph</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">eta</span><span class="p">,</span><span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="p">)</span>

    <span class="c1"># remove edges that cross buildings</span>
    <span class="k">if</span> <span class="n">buildings</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">buildings</span> <span class="o">!=</span> <span class="p">[]:</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">()):</span>
            <span class="n">blocked</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">intersect</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="n">pos</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">):</span>
                    <span class="n">blocked</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">blocked</span><span class="p">:</span>
                <span class="n">G</span><span class="o">.</span><span class="n">remove_edge</span><span class="p">(</span><span class="o">*</span><span class="n">e</span><span class="p">)</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">DiGraph</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>

    <span class="c1"># add edges connecting dummy nodes to nodes on left and right edges of grid</span>
    <span class="k">if</span> <span class="n">dummyNodes</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
            <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">G</span><span class="p">,</span> <span class="n">pos</span>

<span class="k">def</span> <span class="nf">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edgeProbs</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">visibleNodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">Rnodes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">guards</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Takes directed graph G, node positions pos, and edge probabilities.</span>
<span class="sd">        Optionally uses path (a list of edge indices) to plot the smuggler&#39;s path.</span>

<span class="sd">        edgeProbd gives the probabilities for all the edges, including hidden ones.</span>

<span class="sd">        path includes all the edges, including the hidden ones</span>

<span class="sd">        Gnodes and Rnodes denote the source and destination nodes, to be plotted green</span>
<span class="sd">        and red respectively.</span>

<span class="sd">        guards is a list of node indices for denoting guards with a black dot on the plot</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">visibleNodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">visibleNodes</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">nodes</span><span class="p">()</span>

    <span class="c1"># draw the regular interior nodes in the graph</span>
    <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">nodelist</span><span class="o">=</span><span class="n">visibleNodes</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                           <span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">node_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

    <span class="c1"># draw the origin and destination nodes</span>
    <span class="k">for</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="n">Gnodes</span><span class="p">,</span><span class="n">Rnodes</span><span class="p">],[</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">color2</span><span class="p">,</span> <span class="n">alpha</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">color</span><span class="p">],[</span><span class="mi">1</span><span class="p">,</span><span class="mf">.2</span><span class="p">]):</span>
            <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span>
                           <span class="n">nodelist</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span>
                           <span class="n">node_color</span><span class="o">=</span><span class="n">color2</span><span class="p">,</span>
                           <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                           <span class="n">node_size</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
                           <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

    <span class="c1"># draw guard nodes</span>
    <span class="k">if</span> <span class="n">guards</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_nodes</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">nodelist</span><span class="o">=</span><span class="n">guards</span><span class="p">,</span><span class="n">node_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                               <span class="n">node_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">.15</span>

    <span class="c1"># start messing with edges</span>
    <span class="n">edge2ind</span> <span class="o">=</span> <span class="p">{</span><span class="n">e</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())}</span>
    <span class="n">ind2edge</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span><span class="n">e</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())}</span>

    <span class="c1"># only display edges between non-dummy nodes</span>
    <span class="n">visibleEdges</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">edge2ind</span><span class="p">))</span> <span class="k">if</span> <span class="n">ind2edge</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">visibleNodes</span> <span class="ow">and</span> <span class="n">ind2edge</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">visibleNodes</span><span class="p">]</span>

    <span class="n">edgelist</span> <span class="o">=</span> <span class="p">[</span><span class="n">ind2edge</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">visibleEdges</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">edgeProbs</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
        <span class="n">edgeProbs</span> <span class="o">=</span> <span class="p">[</span><span class="n">edgeProbs</span><span class="p">]</span><span class="o">*</span><span class="n">G</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>

    <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="n">edgeProbs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">visibleEdges</span><span class="p">]</span>

    <span class="c1"># draw edges of graph, make transparent if we&#39;re drawing a path over them</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edge_color</span><span class="o">=</span><span class="n">p</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                   <span class="n">edge_cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlGn</span><span class="p">,</span><span class="n">arrows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">edgelist</span><span class="o">=</span><span class="n">edgelist</span><span class="p">,</span><span class="n">edge_vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                   <span class="n">edge_vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>

    <span class="c1"># draw the path, only between visible nodes</span>
    <span class="k">if</span> <span class="n">path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">visiblePath</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">path</span> <span class="k">if</span> <span class="n">ind2edge</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">visibleNodes</span> <span class="ow">and</span> <span class="n">ind2edge</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">visibleNodes</span><span class="p">]</span>
        <span class="n">path_pairs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ind2edge</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">visiblePath</span><span class="p">]</span>
        <span class="n">path_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">edgeProbs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">visiblePath</span><span class="p">]</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">draw_networkx_edges</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edge_color</span><span class="o">=</span><span class="n">path_colors</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
                                       <span class="n">edge_cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdYlGn</span><span class="p">,</span><span class="n">edgelist</span><span class="o">=</span><span class="n">path_pairs</span><span class="p">,</span><span class="n">arrows</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">edge_vmin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
                                   <span class="n">edge_vmax</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Evasion probability&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">1.05</span><span class="p">,</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">1.05</span><span class="p">])</span>
    <span class="c1">#ax.axis(&#39;tight&#39;)</span>
    <span class="c1">#ax.axis(&#39;equal&#39;)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

<span class="k">def</span> <span class="nf">optPath</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">p</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Find the optimal smuggler&#39;s path in directed graph G</span>
<span class="sd">        with edge evasion probabilities p and dictionary</span>
<span class="sd">        edge2ind bringing node pairs to edge indices</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">edge2ind</span> <span class="o">=</span> <span class="p">{</span><span class="n">e</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())}</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">H</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">H</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;w&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">edge2ind</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]]</span>

    <span class="n">path</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">shortest_path</span><span class="p">(</span><span class="n">H</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="c1">#path = nx.astar_path(H,0,n-1,weight=&#39;w&#39;)</span>

    <span class="n">foo</span> <span class="o">=</span> <span class="p">[</span><span class="n">edge2ind</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">x</span><span class="p">[</span><span class="n">foo</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="k">def</span> <span class="nf">intersect</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span><span class="n">p2</span><span class="p">,</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;determine if a rectangle given by xy limits blocks the line of sight between p1 and p2&#39;&#39;&#39;</span>

    <span class="n">block</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># if either point inside block</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span><span class="n">p1</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">xmin</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">xmax</span> <span class="ow">and</span> <span class="n">ymin</span> <span class="o">&lt;=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">ymax</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># if the two points are equal at this stage, then they are outside the block</span>
    <span class="k">if</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">return</span> <span class="kc">False</span>


    <span class="k">if</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">]:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">alpha</span> <span class="ow">and</span> <span class="n">alpha</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ymin</span> <span class="o">&lt;=</span> <span class="n">y</span> <span class="ow">and</span> <span class="n">y</span> <span class="o">&lt;=</span> <span class="n">ymax</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">]:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span><span class="o">*</span><span class="p">(</span><span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">alpha</span> <span class="ow">and</span> <span class="n">alpha</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">xmin</span> <span class="o">&lt;=</span> <span class="n">x</span> <span class="ow">and</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">xmax</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="kc">False</span>

<span class="k">def</span> <span class="nf">getGuardEffects</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">guardIdxs</span><span class="p">,</span><span class="n">buildings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; for n guards and m edges, return an m by n matrix giving the</span>
<span class="sd">        effect of each guard on the evasion probabilities of each edge</span>
<span class="sd">        in the graph.</span>

<span class="sd">        Ignore dummy nodes, if any. Guards cannot see through buildings.</span>

<span class="sd">        guardIdxs is a list of the node indices where we would consider placing</span>
<span class="sd">        guards</span>

<span class="sd">        Return the log of the detection probabilities for each guard.</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">evadeProb</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">radius</span><span class="o">=</span><span class="mf">.2</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">radius</span>
        <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mf">.1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">m</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">buildings</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">buildings</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">dummyNodes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">dummyNodes</span> <span class="o">=</span> <span class="p">[]</span>


    <span class="n">ind2edge</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span><span class="n">e</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())}</span>
    <span class="n">edgeCenters</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
        <span class="n">edgeCenters</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">edgeCenters</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">edgeCenters</span><span class="p">)</span>
    <span class="n">numGuards</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">guardIdxs</span><span class="p">)</span>
    <span class="n">edgeVals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="p">,</span><span class="n">numGuards</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">gid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">guardIdxs</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
            <span class="n">blocked</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">intersect</span><span class="p">(</span><span class="n">edgeCenters</span><span class="p">[</span><span class="n">j</span><span class="p">,:],</span><span class="n">pos</span><span class="p">[</span><span class="n">gid</span><span class="p">],</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="o">+</span><span class="n">w</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">y</span><span class="o">+</span><span class="n">h</span><span class="p">):</span>
                    <span class="n">blocked</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="k">break</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">ind2edge</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dummyNodes</span> <span class="ow">or</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dummyNodes</span><span class="p">:</span>
                <span class="n">blocked</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">blocked</span><span class="p">:</span>
                <span class="n">edgeVals</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">evadeProb</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="n">gid</span><span class="p">]</span><span class="o">-</span><span class="n">edgeCenters</span><span class="p">[</span><span class="n">j</span><span class="p">,:],</span><span class="mf">.3</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">edgeVals</span>

<span class="k">def</span> <span class="nf">get_a</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Generate a random value in [0,1] for each edge in the graph.</span>
<span class="sd">    For directed graphs, directed edges between the same nodes should have the same value</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_edges</span><span class="p">()</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="p">))</span>
    <span class="n">edge2ind</span> <span class="o">=</span> <span class="p">{</span><span class="n">e</span><span class="p">:</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())}</span>
    <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">():</span>
        <span class="n">a</span><span class="p">[</span><span class="n">edge2ind</span><span class="p">[</span><span class="n">e</span><span class="p">]]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span>
        <span class="n">e2</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">e2</span> <span class="ow">in</span> <span class="n">edge2ind</span><span class="p">:</span>
            <span class="n">a</span><span class="p">[</span><span class="n">edge2ind</span><span class="p">[</span><span class="n">e2</span><span class="p">]]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">edge2ind</span><span class="p">[</span><span class="n">e</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">a</span>
</pre></div>
</div>
</section>
<section id="smuggler-s-objective">
<h1>Smuggler’s objective<a class="headerlink" href="#smuggler-s-objective" title="Permalink to this headline">¶</a></h1>
<p>The smuggler chooses a path <span class="math notranslate nohighlight">\(\mathcal{P}\)</span> only after <span class="math notranslate nohighlight">\(c\)</span> is
fixed. His goal is to find a valid path in the graph which maximizes
<span class="math notranslate nohighlight">\(\sum_{j \in \mathcal{P}} c_j\)</span>. Note that this problem can be cast
and solved exactly as a <a class="reference external" href="http://en.wikipedia.org/wiki/Shortest_path_problem">shortest path problem in graph
theory</a>. We
formulate it here as a convex problem so that the security team can use
the model to thwart the smuggler.</p>
<p>We’ll denote possible paths with a Boolean decision variable
<span class="math notranslate nohighlight">\(x \in \lbrace 0,1 \rbrace^m\)</span>, where <span class="math notranslate nohighlight">\(x_j = 1\)</span> denotes
<span class="math notranslate nohighlight">\(j \in \mathcal{P}\)</span>. Note that this allows us to write the
smuggler’s objective as</p>
<div class="math notranslate nohighlight">
\[\sum_{j \in \mathcal{P}} c_j = \sum_{j=0}^{n-1} c_j x_j = c^T x.\]</div>
<p>The <span class="math notranslate nohighlight">\(x\)</span> variable needs to satisfy certain constraints to represent
a valid path. Firstly, the number of times the path exits the source
node must be exactly one more than the number of times it enters the
source node. Similarly, the number of times the path enters the
destination node must be exactly one more than the number of times it
exits destination node. For all other nodes in the graph, the number of
times the path enters and exits the node must be equal. These
constraints can be represented as <span class="math notranslate nohighlight">\(Ax = b\)</span>, where</p>
<p>\[ b_i = ]</p>
<p>\[ A_{ij} = ]</p>
<p>The smuggler’s problem can then be written so that
<span class="math notranslate nohighlight">\(P^\mathrm{opt}(c)\)</span> is the optimum value of the problem</p>
<p>\[ ]</p>
<p>This is a linear problem with Boolean variables, which is not convex,
but we can transform it into a convex problem by relaxing the Boolean
constraints to get the linear program</p>
<p>\[ ] with optimum value <span class="math notranslate nohighlight">\(P^{\mathrm{opt}}_\mathrm{R}(c)\)</span>.</p>
<p>It turns out that this relaxed convex problem solves the original
Boolean problem <em>exactly</em>. That is,
<span class="math notranslate nohighlight">\(P^{\mathrm{opt}}(c) = P^{\mathrm{opt}}_\mathrm{R}(c)\)</span>, so we will
only write <span class="math notranslate nohighlight">\(P^{\mathrm{opt}}\)</span> in the remainder. In addition, the
solution to the LP, <span class="math notranslate nohighlight">\(x^\star\)</span>, will be Boolean when there is a
unique optimal path. In the presence of multiple optimal paths, the
<span class="math notranslate nohighlight">\(x^\star\)</span> may have fractional entries, but an optimal path can
still be recovered.</p>
<p>For the purposes of the security team, we’ll only need that the Boolean
and LP optimal values are equal. Before continuing on to security’s
perspective, we’ll look at an example of the smuggler choosing an
optimal path in a given graph.</p>
</section>
<section id="smuggler-s-path-example">
<h1>Smuggler’s path example<a class="headerlink" href="#smuggler-s-path-example" title="Permalink to this headline">¶</a></h1>
<p>We’ll solve the smuggler’s problem on an example network to see an
example of an optimal path.</p>
<p>We’ll create an <span class="math notranslate nohighlight">\(N \times N\)</span> grid of points with small
perturbations to make the graph irregular, connecting two nodes with two
directed edges (one going each way) if the nodes are within distance
<span class="math notranslate nohighlight">\(\eta\)</span> of each other. Pairs of edges <span class="math notranslate nohighlight">\((i,j)\)</span> and
<span class="math notranslate nohighlight">\((j,i)\)</span> will have identical evasion probabilities, i.e., the
evasion probability is the same in either direction between two
connected nodes. The evasion probability will be distributed like
<span class="math notranslate nohighlight">\(p_j = e^{-a_j}\)</span>, where <span class="math notranslate nohighlight">\(a_j\)</span> is a uniform random variable
over the interval <span class="math notranslate nohighlight">\(\left[0,1\right]\)</span>.</p>
<p>The smuggler will find an optimal path from node <span class="math notranslate nohighlight">\(0\)</span> in the
upper-left corner of the graph plot to node <span class="math notranslate nohighlight">\(n-1\)</span> in the
lower-right corner of the graph plot.</p>
<p>We show the graph with the edge evasion probabilities below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">G</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">formGraph</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mf">.12</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">get_a</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Rnodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">anaconda3</span><span class="o">/</span><span class="n">envs</span><span class="o">/</span><span class="n">cvxpy</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.6</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">networkx</span><span class="o">/</span><span class="n">drawing</span><span class="o">/</span><span class="n">nx_pylab</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">611</span><span class="p">:</span> <span class="n">MatplotlibDeprecationWarning</span><span class="p">:</span> <span class="nb">isinstance</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">cb</span><span class="o">.</span><span class="n">is_numlike</span><span class="p">(</span><span class="n">alpha</span><span class="p">):</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_5_1.png"><img alt="../../_images/interdiction_5_1.png" src="../../_images/interdiction_5_1.png" style="width: 438px; height: 360px;" /></a>
<p>We form the smuggler’s relaxed convex problem and solve it to find his
optimal path. We plot the path below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">incidence_matrix</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">oriented</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="n">n</span><span class="p">,</span><span class="n">m</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">b</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="n">edge2ind</span> <span class="o">=</span> <span class="p">{</span><span class="n">e</span><span class="p">:</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">e</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">edges</span><span class="p">())}</span>

<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">m</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">m</span><span class="p">))</span>
<span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">G</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">G</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="p">:</span>
            <span class="n">B</span><span class="p">[</span><span class="n">count</span><span class="p">,</span><span class="n">edge2ind</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)]]</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">B</span><span class="p">[</span><span class="n">count</span><span class="p">,</span><span class="n">edge2ind</span><span class="p">[(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)]]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>


<span class="n">x</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
<span class="n">constr</span> <span class="o">=</span> <span class="p">[</span><span class="n">A</span><span class="o">*</span><span class="n">x</span> <span class="o">==</span> <span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">cp</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">Maximize</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">c</span><span class="p">),</span><span class="n">constr</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-----------------------------------------------------------------</span>
           <span class="n">OSQP</span> <span class="n">v0</span><span class="mf">.4.1</span>  <span class="o">-</span>  <span class="n">Operator</span> <span class="n">Splitting</span> <span class="n">QP</span> <span class="n">Solver</span>
              <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="n">Bartolomeo</span> <span class="n">Stellato</span><span class="p">,</span>  <span class="n">Goran</span> <span class="n">Banjac</span>
        <span class="n">University</span> <span class="n">of</span> <span class="n">Oxford</span>  <span class="o">-</span>  <span class="n">Stanford</span> <span class="n">University</span> <span class="mi">2018</span>
<span class="o">-----------------------------------------------------------------</span>
<span class="n">problem</span><span class="p">:</span>  <span class="n">variables</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">354</span><span class="p">,</span> <span class="n">constraints</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">808</span>
          <span class="n">nnz</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">+</span> <span class="n">nnz</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1416</span>
<span class="n">settings</span><span class="p">:</span> <span class="n">linear</span> <span class="n">system</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">qdldl</span><span class="p">,</span>
          <span class="n">eps_abs</span> <span class="o">=</span> <span class="mf">1.0e-03</span><span class="p">,</span> <span class="n">eps_rel</span> <span class="o">=</span> <span class="mf">1.0e-03</span><span class="p">,</span>
          <span class="n">eps_prim_inf</span> <span class="o">=</span> <span class="mf">1.0e-04</span><span class="p">,</span> <span class="n">eps_dual_inf</span> <span class="o">=</span> <span class="mf">1.0e-04</span><span class="p">,</span>
          <span class="n">rho</span> <span class="o">=</span> <span class="mf">1.00e-01</span> <span class="p">(</span><span class="n">adaptive</span><span class="p">),</span>
          <span class="n">sigma</span> <span class="o">=</span> <span class="mf">1.00e-06</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.60</span><span class="p">,</span> <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">4000</span>
          <span class="n">check_termination</span><span class="p">:</span> <span class="n">on</span> <span class="p">(</span><span class="n">interval</span> <span class="mi">25</span><span class="p">),</span>
          <span class="n">scaling</span><span class="p">:</span> <span class="n">on</span><span class="p">,</span> <span class="n">scaled_termination</span><span class="p">:</span> <span class="n">off</span>
          <span class="n">warm</span> <span class="n">start</span><span class="p">:</span> <span class="n">on</span><span class="p">,</span> <span class="n">polish</span><span class="p">:</span> <span class="n">on</span>

<span class="nb">iter</span>   <span class="n">objective</span>    <span class="n">pri</span> <span class="n">res</span>    <span class="n">dua</span> <span class="n">res</span>    <span class="n">rho</span>        <span class="n">time</span>
   <span class="mi">1</span>  <span class="o">-</span><span class="mf">8.9458e+02</span>   <span class="mf">8.00e+00</span>   <span class="mf">9.97e+01</span>   <span class="mf">1.00e-01</span>   <span class="mf">2.10e-03</span><span class="n">s</span>
  <span class="mi">75</span>   <span class="mf">5.0606e+00</span>   <span class="mf">1.47e-03</span>   <span class="mf">5.64e-05</span>   <span class="mf">1.00e-01</span>   <span class="mf">8.35e-03</span><span class="n">s</span>

<span class="n">status</span><span class="p">:</span>               <span class="n">solved</span>
<span class="n">solution</span> <span class="n">polish</span><span class="p">:</span>      <span class="n">unsuccessful</span>
<span class="n">number</span> <span class="n">of</span> <span class="n">iterations</span><span class="p">:</span> <span class="mi">75</span>
<span class="n">optimal</span> <span class="n">objective</span><span class="p">:</span>    <span class="mf">5.0606</span>
<span class="n">run</span> <span class="n">time</span><span class="p">:</span>             <span class="mf">1.15e-02</span><span class="n">s</span>
<span class="n">optimal</span> <span class="n">rho</span> <span class="n">estimate</span><span class="p">:</span> <span class="mf">5.09e-01</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">.1</span><span class="p">))</span>
<span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Rnodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The evasion probability of the smuggler&#39;s &quot;</span>
      <span class="s2">&quot;optimal path is </span><span class="si">%e</span><span class="s2">, or </span><span class="si">%.3f%%</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">evasion</span> <span class="n">probability</span> <span class="n">of</span> <span class="n">the</span> <span class="n">smuggler</span><span class="s1">&#39;s optimal path is 6.341943e-03, or 0.634%.</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_8_1.png"><img alt="../../_images/interdiction_8_1.png" src="../../_images/interdiction_8_1.png" style="width: 438px; height: 360px;" /></a>
<p>We run a discrete graph-theoretic shortest path algorithm on the same
graph to check that we get the same optimal path. The function
<code class="docutils literal notranslate"><span class="pre">optPath</span></code> is using the NetworkX Python package and
<a class="reference external" href="http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm">Dijkstra’s_algorithm</a>
to compute the optimal path.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">optPath</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mf">.1</span><span class="p">))</span>
<span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Rnodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The evasion probability of the smuggler&#39;s &quot;</span>
      <span class="s2">&quot;optimal path is </span><span class="si">%e</span><span class="s2">, or </span><span class="si">%.3f%%</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="o">*</span><span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">evasion</span> <span class="n">probability</span> <span class="n">of</span> <span class="n">the</span> <span class="n">smuggler</span><span class="s1">&#39;s optimal path is 6.343747e-03, or 0.634%.</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_10_1.png"><img alt="../../_images/interdiction_10_1.png" src="../../_images/interdiction_10_1.png" style="width: 438px; height: 360px;" /></a>
</section>
<section id="security-s-objective">
<h1>Security’s objective<a class="headerlink" href="#security-s-objective" title="Permalink to this headline">¶</a></h1>
<p>The security team’s goal is to minimize <span class="math notranslate nohighlight">\(P^\mathrm{opt}(c)\)</span>,
subject to some constraints (say, limits on budget or personnel), which
we’ll denote by <span class="math notranslate nohighlight">\(c \in \mathcal{C}\)</span>:</p>
<p>\[ ]</p>
<p>But note that <span class="math notranslate nohighlight">\(P^{\mathrm{opt}}(c)\)</span> is the optimal value of the
problem</p>
<p>\[ ]</p>
<p>We’d like to combine these two optimization problems into a single
problem for the security team to solve, but this is problematic as the
variables of one problem, <span class="math notranslate nohighlight">\(x\)</span>, are multiplied with the variables
of the other, <span class="math notranslate nohighlight">\(c\)</span>, which is not a convex objective in general. To
get around this, we’ll take the dual (Chapter 5 of the <a class="reference external" href="http://web.stanford.edu/~boyd/cvxbook/">Convex
Optimization book</a>) of the
smuggler’s problem.</p>
<p>Let <span class="math notranslate nohighlight">\(D^\mathrm{opt}(c)\)</span> denote the optimal value of the dual of
the smuggler’s problem, which is</p>
<p>\[ ] with dual variable <span class="math notranslate nohighlight">\(\lambda\)</span>.</p>
<p>Duality theory guarantees that
<span class="math notranslate nohighlight">\(D^\mathrm{opt}(c) = P^{\mathrm{opt}}(c)\)</span>, which allows us to
write the security team’s problem as</p>
<p>\[ ] which we can rewrite as the single optimization problem</p>
<p>\[ ] where <span class="math notranslate nohighlight">\(c\)</span> and <span class="math notranslate nohighlight">\(\lambda\)</span> are the optimization
variables.</p>
<p>We will denote the optimal value of this problem as <span class="math notranslate nohighlight">\(P^\star\)</span>. By
solving to find <span class="math notranslate nohighlight">\(c^\star\)</span>, the security team will have optimally
allocated resources to make detection of the smuggler as likely as
possible.</p>
</section>
<section id="security-example">
<h1>Security example<a class="headerlink" href="#security-example" title="Permalink to this headline">¶</a></h1>
<p>We’ll consider security’s problem on the same network as the last
example with the edge evasion probabilities modeled as
<span class="math notranslate nohighlight">\(p_j = e^{-a_j r_j}\)</span>, where <span class="math notranslate nohighlight">\(r_j \in \mathbf{R}_+\)</span> denotes
the effort (say, yearly budget) allocated to edge <span class="math notranslate nohighlight">\(j\)</span>. We’ll
assume <span class="math notranslate nohighlight">\(a_j \in \mathbf{R}_{++}\)</span> are given and represent the cost
involved in securing an edge. As in the last example, <span class="math notranslate nohighlight">\(a_j\)</span> is a
uniform random variable over the interval <span class="math notranslate nohighlight">\(\left[0,1\right]\)</span>.</p>
<p>We’ll use the same random seed as the last example, so the last example
corresponds to the specific allocation <span class="math notranslate nohighlight">\(r_j = 1\)</span> for all <span class="math notranslate nohighlight">\(j\)</span>
in the current model. We’ll use this to compare the detection
probability of a naive, uniform effort allocation against the optimal
allocation.</p>
<p>For this example, we’ll impose a maximum budget constraint
<span class="math notranslate nohighlight">\(\sum_{j=0}^{m-1} r_j = m\)</span>, and a uniform spending limit on each
edge, <span class="math notranslate nohighlight">\(r_j \leq R\)</span>.</p>
<p>We’ll also constrain that the evasion probability is equal in both
directions. That is, edge <span class="math notranslate nohighlight">\((i,j)\)</span> and edge <span class="math notranslate nohighlight">\((j,i)\)</span> have
equal evasion probabilities. We’ll enforce that constraint with
<span class="math notranslate nohighlight">\(Br = 0\)</span>, for some matrix <span class="math notranslate nohighlight">\(B\)</span>.</p>
<p>The final model is \[ ]</p>
<p>We solve the model below with <span class="math notranslate nohighlight">\(R=5\)</span> and report the evasion
probability of the smuggler’s optimal path.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">nu</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
<span class="n">constr</span> <span class="o">=</span> <span class="p">[</span><span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">nu</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="n">cp</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">r</span><span class="p">),</span> <span class="n">cp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">==</span> <span class="n">m</span><span class="p">,</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">B</span><span class="o">*</span><span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">cp</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">Minimize</span><span class="p">(</span><span class="n">nu</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="p">),</span><span class="n">constr</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nu</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-----------------------------------------------------------------</span>
           <span class="n">OSQP</span> <span class="n">v0</span><span class="mf">.4.1</span>  <span class="o">-</span>  <span class="n">Operator</span> <span class="n">Splitting</span> <span class="n">QP</span> <span class="n">Solver</span>
              <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="n">Bartolomeo</span> <span class="n">Stellato</span><span class="p">,</span>  <span class="n">Goran</span> <span class="n">Banjac</span>
        <span class="n">University</span> <span class="n">of</span> <span class="n">Oxford</span>  <span class="o">-</span>  <span class="n">Stanford</span> <span class="n">University</span> <span class="mi">2018</span>
<span class="o">-----------------------------------------------------------------</span>
<span class="n">problem</span><span class="p">:</span>  <span class="n">variables</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">454</span><span class="p">,</span> <span class="n">constraints</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">1240</span>
          <span class="n">nnz</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">+</span> <span class="n">nnz</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">=</span> <span class="mi">2478</span>
<span class="n">settings</span><span class="p">:</span> <span class="n">linear</span> <span class="n">system</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">qdldl</span><span class="p">,</span>
          <span class="n">eps_abs</span> <span class="o">=</span> <span class="mf">1.0e-03</span><span class="p">,</span> <span class="n">eps_rel</span> <span class="o">=</span> <span class="mf">1.0e-03</span><span class="p">,</span>
          <span class="n">eps_prim_inf</span> <span class="o">=</span> <span class="mf">1.0e-04</span><span class="p">,</span> <span class="n">eps_dual_inf</span> <span class="o">=</span> <span class="mf">1.0e-04</span><span class="p">,</span>
          <span class="n">rho</span> <span class="o">=</span> <span class="mf">1.00e-01</span> <span class="p">(</span><span class="n">adaptive</span><span class="p">),</span>
          <span class="n">sigma</span> <span class="o">=</span> <span class="mf">1.00e-06</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.60</span><span class="p">,</span> <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">4000</span>
          <span class="n">check_termination</span><span class="p">:</span> <span class="n">on</span> <span class="p">(</span><span class="n">interval</span> <span class="mi">25</span><span class="p">),</span>
          <span class="n">scaling</span><span class="p">:</span> <span class="n">on</span><span class="p">,</span> <span class="n">scaled_termination</span><span class="p">:</span> <span class="n">off</span>
          <span class="n">warm</span> <span class="n">start</span><span class="p">:</span> <span class="n">on</span><span class="p">,</span> <span class="n">polish</span><span class="p">:</span> <span class="n">on</span>

<span class="nb">iter</span>   <span class="n">objective</span>    <span class="n">pri</span> <span class="n">res</span>    <span class="n">dua</span> <span class="n">res</span>    <span class="n">rho</span>        <span class="n">time</span>
   <span class="mi">1</span>  <span class="o">-</span><span class="mf">3.3084e+01</span>   <span class="mf">3.54e+02</span>   <span class="mf">3.54e+04</span>   <span class="mf">1.00e-01</span>   <span class="mf">2.59e-03</span><span class="n">s</span>
 <span class="mi">100</span>  <span class="o">-</span><span class="mf">2.2269e+01</span>   <span class="mf">3.28e-01</span>   <span class="mf">1.58e-03</span>   <span class="mf">5.35e-03</span>   <span class="mf">9.06e-03</span><span class="n">s</span>

<span class="n">status</span><span class="p">:</span>               <span class="n">solved</span>
<span class="n">solution</span> <span class="n">polish</span><span class="p">:</span>      <span class="n">unsuccessful</span>
<span class="n">number</span> <span class="n">of</span> <span class="n">iterations</span><span class="p">:</span> <span class="mi">100</span>
<span class="n">optimal</span> <span class="n">objective</span><span class="p">:</span>    <span class="o">-</span><span class="mf">22.2692</span>
<span class="n">run</span> <span class="n">time</span><span class="p">:</span>             <span class="mf">1.05e-02</span><span class="n">s</span>
<span class="n">optimal</span> <span class="n">rho</span> <span class="n">estimate</span><span class="p">:</span> <span class="mf">4.10e-03</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The evasion probability of the smuggler&#39;s optimal path is </span><span class="si">%e</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">nu</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">)),))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The smuggler&#39;s chance of evasion is </span><span class="si">%.2f</span><span class="s2"> times smaller than with the uniform resource allocation.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">nu</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">))))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">evasion</span> <span class="n">probability</span> <span class="n">of</span> <span class="n">the</span> <span class="n">smuggler</span><span class="s1">&#39;s optimal path is 2.131035e-10.</span>
<span class="n">The</span> <span class="n">smuggler</span><span class="s1">&#39;s chance of evasion is 29759913.87 times smaller than with the uniform resource allocation.</span>
</pre></div>
</div>
<p>Here we plot the resulting edge evasion probabilities from the optimal
allocation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="o">*</span><span class="n">r</span><span class="p">)</span>
<span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Rnodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="o">&lt;</span><span class="n">Figure</span> <span class="n">size</span> <span class="mi">576</span><span class="n">x432</span> <span class="k">with</span> <span class="mi">2</span> <span class="n">Axes</span><span class="o">&gt;</span><span class="p">,</span>
 <span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">_subplots</span><span class="o">.</span><span class="n">AxesSubplot</span> <span class="n">at</span> <span class="mh">0xd19325278</span><span class="o">&gt;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_15_1.png"><img alt="../../_images/interdiction_15_1.png" src="../../_images/interdiction_15_1.png" style="width: 438px; height: 360px;" /></a>
<p>We can now solve the smuggler’s problem with these optimal resource
allocations, but we won’t recover a Boolean solution for
<span class="math notranslate nohighlight">\(x^{\star}\)</span> because the optimal path is not unique. Note, however,
that the optimal evasion probability is the same.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
<span class="n">constr</span> <span class="o">=</span> <span class="p">[</span><span class="n">A</span><span class="o">*</span><span class="n">x</span> <span class="o">==</span> <span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">cp</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">Maximize</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">c</span><span class="p">),</span><span class="n">constr</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The evasion probability of the smuggler&#39;s optimal path is </span><span class="si">%e</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">)),))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-----------------------------------------------------------------</span>
           <span class="n">OSQP</span> <span class="n">v0</span><span class="mf">.4.1</span>  <span class="o">-</span>  <span class="n">Operator</span> <span class="n">Splitting</span> <span class="n">QP</span> <span class="n">Solver</span>
              <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="n">Bartolomeo</span> <span class="n">Stellato</span><span class="p">,</span>  <span class="n">Goran</span> <span class="n">Banjac</span>
        <span class="n">University</span> <span class="n">of</span> <span class="n">Oxford</span>  <span class="o">-</span>  <span class="n">Stanford</span> <span class="n">University</span> <span class="mi">2018</span>
<span class="o">-----------------------------------------------------------------</span>
<span class="n">problem</span><span class="p">:</span>  <span class="n">variables</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">354</span><span class="p">,</span> <span class="n">constraints</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">808</span>
          <span class="n">nnz</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">+</span> <span class="n">nnz</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">=</span> <span class="mi">1416</span>
<span class="n">settings</span><span class="p">:</span> <span class="n">linear</span> <span class="n">system</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">qdldl</span><span class="p">,</span>
          <span class="n">eps_abs</span> <span class="o">=</span> <span class="mf">1.0e-03</span><span class="p">,</span> <span class="n">eps_rel</span> <span class="o">=</span> <span class="mf">1.0e-03</span><span class="p">,</span>
          <span class="n">eps_prim_inf</span> <span class="o">=</span> <span class="mf">1.0e-04</span><span class="p">,</span> <span class="n">eps_dual_inf</span> <span class="o">=</span> <span class="mf">1.0e-04</span><span class="p">,</span>
          <span class="n">rho</span> <span class="o">=</span> <span class="mf">1.00e-01</span> <span class="p">(</span><span class="n">adaptive</span><span class="p">),</span>
          <span class="n">sigma</span> <span class="o">=</span> <span class="mf">1.00e-06</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.60</span><span class="p">,</span> <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">4000</span>
          <span class="n">check_termination</span><span class="p">:</span> <span class="n">on</span> <span class="p">(</span><span class="n">interval</span> <span class="mi">25</span><span class="p">),</span>
          <span class="n">scaling</span><span class="p">:</span> <span class="n">on</span><span class="p">,</span> <span class="n">scaled_termination</span><span class="p">:</span> <span class="n">off</span>
          <span class="n">warm</span> <span class="n">start</span><span class="p">:</span> <span class="n">on</span><span class="p">,</span> <span class="n">polish</span><span class="p">:</span> <span class="n">on</span>

<span class="nb">iter</span>   <span class="n">objective</span>    <span class="n">pri</span> <span class="n">res</span>    <span class="n">dua</span> <span class="n">res</span>    <span class="n">rho</span>        <span class="n">time</span>
   <span class="mi">1</span>  <span class="o">-</span><span class="mf">8.8977e+02</span>   <span class="mf">8.00e+00</span>   <span class="mf">4.71e+02</span>   <span class="mf">1.00e-01</span>   <span class="mf">9.14e-04</span><span class="n">s</span>
 <span class="mi">200</span>   <span class="mf">2.0447e+01</span>   <span class="mf">7.16e-03</span>   <span class="mf">6.89e-03</span>   <span class="mf">1.00e-01</span>   <span class="mf">6.66e-03</span><span class="n">s</span>
 <span class="mi">325</span>   <span class="mf">2.0607e+01</span>   <span class="mf">9.79e-04</span>   <span class="mf">2.46e-03</span>   <span class="mf">1.00e-01</span>   <span class="mf">9.95e-03</span><span class="n">s</span>

<span class="n">status</span><span class="p">:</span>               <span class="n">solved</span>
<span class="n">solution</span> <span class="n">polish</span><span class="p">:</span>      <span class="n">unsuccessful</span>
<span class="n">number</span> <span class="n">of</span> <span class="n">iterations</span><span class="p">:</span> <span class="mi">325</span>
<span class="n">optimal</span> <span class="n">objective</span><span class="p">:</span>    <span class="mf">20.6072</span>
<span class="n">run</span> <span class="n">time</span><span class="p">:</span>             <span class="mf">1.08e-02</span><span class="n">s</span>
<span class="n">optimal</span> <span class="n">rho</span> <span class="n">estimate</span><span class="p">:</span> <span class="mf">1.37e-01</span>

<span class="n">The</span> <span class="n">evasion</span> <span class="n">probability</span> <span class="n">of</span> <span class="n">the</span> <span class="n">smuggler</span><span class="s1">&#39;s optimal path is 1.123036e-09.</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_17_1.png"><img alt="../../_images/interdiction_17_1.png" src="../../_images/interdiction_17_1.png" style="width: 373px; height: 250px;" /></a>
<p>We use
<a class="reference external" href="http://en.wikipedia.org/wiki/Dijkstra%27s_algorithm">Dijkstra’s_algorithm</a>
again to recover an optimal path for the smuggler in the case that the
path is not unique and plot it below. We again check that the detection
probability is what we predicted previously.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">optPath</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">.1</span><span class="p">))</span>
<span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Rnodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The evasion probability of the smuggler&#39;s optimal path is </span><span class="si">%e</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">)),))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">evasion</span> <span class="n">probability</span> <span class="n">of</span> <span class="n">the</span> <span class="n">smuggler</span><span class="s1">&#39;s optimal path is 9.553365e-10.</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_19_1.png"><img alt="../../_images/interdiction_19_1.png" src="../../_images/interdiction_19_1.png" style="width: 438px; height: 360px;" /></a>
</section>
<section id="guard-placement-example">
<h1>Guard placement example<a class="headerlink" href="#guard-placement-example" title="Permalink to this headline">¶</a></h1>
<p>We can now go through a more advanced example.</p>
<p>In the previous example, security had direct control over the evasion
probability on each edge. In this section, we’ll consider an example
where security can only control the edge probabilities through the
placement of guards, each of whom will effect edges which are close to
them.</p>
<p>In the last example, the security team put a lot of effort on edges near
the source and destination nodes. We’ll make the team’s job a bit harder
by allowing the smuggler’s path to start at any node on the left side of
the graph, and end at any node on the right. This will force the team to
allocate resources more evenly over the graph.</p>
<p>To make things even more interesting, we’ll add ‘buildings’ in the
region covered by the graph. The smuggler and security will have to work
around the buildings. That is, no node is located inside a building, no
edge crosses through a building, and guards can’t see through building
walls, restricting their line-of-sight and effect on nearby edges.</p>
<section id="multiple-sources-and-destinations">
<h2>Multiple sources and destinations<a class="headerlink" href="#multiple-sources-and-destinations" title="Permalink to this headline">¶</a></h2>
<p>To allow for multiple source and destination nodes without changing the
convex formulation, we’ll add a dummy source node and a dummy sink node.
The source node will have edges going to each node in the graph on the
left hand side. The sink node will have edges going to each node on the
right. We’ll ensure that these dummy edges always have evasion
probability 1. The plot below demonstrates the idea. We won’t plot the
dummy nodes or edges, but we will highlight the ‘new’ source and sink
nodes with light green and red as before.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># show dummy source and destination node</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">G</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">formGraph</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mf">.1</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Rnodes</span><span class="o">=</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="o">-</span><span class="mf">.6</span><span class="p">,</span><span class="mf">1.6</span><span class="p">,</span><span class="o">-</span><span class="mf">.05</span><span class="p">,</span><span class="mf">1.05</span><span class="p">]);</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_21_0.png"><img alt="../../_images/interdiction_21_0.png" src="../../_images/interdiction_21_0.png" style="width: 469px; height: 350px;" /></a>
</section>
<section id="guards">
<h2>Guards<a class="headerlink" href="#guards" title="Permalink to this headline">¶</a></h2>
<p>The security team will select a subset of guards to place in the graph.
Each guard will have a profile, which gives his effect on the edge
evasion probabilities. The guard’s effect will be a function of his
distance to the center of each edge. In principle, guards could be
placed anywhere in the region occupied by the graph, but we’ll only
consider guards placed on node positions to make them easy to visualize.</p>
<p>An example of a few guards and the resulting evasion probabilities is
shown below.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">G</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">formGraph</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mf">.1</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
<span class="n">guardIdxs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span><span class="n">k</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="n">visibleNodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Gnodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Rnodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">edgeVals</span> <span class="o">=</span> <span class="n">getGuardEffects</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">guardIdxs</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">edgeProbs</span> <span class="o">=</span> <span class="n">edgeVals</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">edgeProbs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">edgeProbs</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edgeProbs</span><span class="p">,</span><span class="n">visibleNodes</span><span class="o">=</span><span class="n">visibleNodes</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="n">Gnodes</span><span class="p">,</span><span class="n">Rnodes</span><span class="o">=</span><span class="n">Rnodes</span><span class="p">,</span><span class="n">guards</span><span class="o">=</span><span class="n">guardIdxs</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_23_0.png"><img alt="../../_images/interdiction_23_0.png" src="../../_images/interdiction_23_0.png" style="width: 438px; height: 360px;" /></a>
</section>
<section id="buildings">
<h2>Buildings<a class="headerlink" href="#buildings" title="Permalink to this headline">¶</a></h2>
<p>We’ll also add buildings, which will modify the graph topology and also
restrict the view of the guards.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">buildings</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">.2</span><span class="p">,</span><span class="mf">.8</span><span class="p">,</span><span class="mf">.3</span><span class="p">,</span><span class="mf">.1</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">.35</span><span class="p">,</span><span class="mf">.1</span><span class="p">,</span><span class="mf">.3</span><span class="p">,</span><span class="mf">.1</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">.55</span><span class="p">,</span><span class="mf">.55</span><span class="p">,</span><span class="mf">.3</span><span class="p">,</span><span class="mf">.1</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">.15</span><span class="p">,</span><span class="mf">.35</span><span class="p">,</span><span class="mf">.3</span><span class="p">,</span><span class="mf">.1</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">.65</span><span class="p">,</span><span class="mf">.25</span><span class="p">,</span><span class="mf">.3</span><span class="p">,</span><span class="mf">.1</span><span class="p">)]</span>

<span class="n">G</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">formGraph</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mf">.11</span><span class="p">,</span><span class="mf">1.25</span><span class="p">,</span><span class="n">buildings</span><span class="o">=</span><span class="n">buildings</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
<span class="n">guardIdxs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span><span class="n">k</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>

<span class="n">visibleNodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Gnodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Rnodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">edgeVals</span> <span class="o">=</span> <span class="n">getGuardEffects</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">guardIdxs</span><span class="p">,</span><span class="n">buildings</span><span class="o">=</span><span class="n">buildings</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">edgeProbs</span> <span class="o">=</span> <span class="n">edgeVals</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">edgeProbs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">edgeProbs</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edgeProbs</span><span class="p">,</span><span class="n">visibleNodes</span><span class="o">=</span><span class="n">visibleNodes</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="n">Gnodes</span><span class="p">,</span><span class="n">Rnodes</span><span class="o">=</span><span class="n">Rnodes</span><span class="p">,</span><span class="n">guards</span><span class="o">=</span><span class="n">guardIdxs</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_25_0.png"><img alt="../../_images/interdiction_25_0.png" src="../../_images/interdiction_25_0.png" style="width: 438px; height: 360px;" /></a>
</section>
</section>
<section id="example-to-solve">
<h1>Example to solve<a class="headerlink" href="#example-to-solve" title="Permalink to this headline">¶</a></h1>
<p>We’ll solve a larger example with buildings, guards, and multiple source
and destination nodes. We’ll consider a guard at every interior node of
the graph, and try to find a limited number, say 10, to secure the graph
as well as possible.</p>
</section>
<section id="id1">
<h1>TODO<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<ul class="simple">
<li><p>optimization formulation</p></li>
<li><p>this one turns out to be a ‘true’ integer program, unlike the last</p></li>
<li><p>use iterative reweighting to get boolean solution</p></li>
<li><p>use relaxation to give bounds on distance to true optimal</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">17</span>
<span class="n">buildings</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">.2</span><span class="p">,</span><span class="mf">.8</span><span class="p">,</span><span class="mf">.3</span><span class="p">,</span><span class="mf">.1</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">.35</span><span class="p">,</span><span class="mf">.1</span><span class="p">,</span><span class="mf">.3</span><span class="p">,</span><span class="mf">.1</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">.55</span><span class="p">,</span><span class="mf">.55</span><span class="p">,</span><span class="mf">.3</span><span class="p">,</span><span class="mf">.1</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">.15</span><span class="p">,</span><span class="mf">.35</span><span class="p">,</span><span class="mf">.3</span><span class="p">,</span><span class="mf">.1</span><span class="p">),</span>
             <span class="p">(</span><span class="mf">.65</span><span class="p">,</span><span class="mf">.3</span><span class="p">,</span><span class="mf">.3</span><span class="p">,</span><span class="mf">.1</span><span class="p">)]</span>

<span class="n">G</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">formGraph</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="mf">.11</span><span class="p">,</span><span class="mf">1.25</span><span class="p">,</span><span class="n">buildings</span><span class="o">=</span><span class="n">buildings</span><span class="p">,</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">number_of_nodes</span><span class="p">()</span>
<span class="n">guardIdxs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

<span class="n">visibleNodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Gnodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">Rnodes</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="n">N</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">edgeVals</span> <span class="o">=</span> <span class="n">getGuardEffects</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">guardIdxs</span><span class="p">,</span><span class="n">buildings</span><span class="o">=</span><span class="n">buildings</span><span class="p">,</span><span class="n">dummyNodes</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">edgeProbs</span> <span class="o">=</span> <span class="n">edgeVals</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">edgeProbs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">edgeProbs</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edgeProbs</span><span class="p">,</span><span class="n">visibleNodes</span><span class="o">=</span><span class="n">visibleNodes</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="n">Gnodes</span><span class="p">,</span><span class="n">Rnodes</span><span class="o">=</span><span class="n">Rnodes</span><span class="p">,</span><span class="n">guards</span><span class="o">=</span><span class="n">guardIdxs</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">16</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_28_0.png"><img alt="../../_images/interdiction_28_0.png" src="../../_images/interdiction_28_0.png" style="width: 575px; height: 469px;" /></a>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">incidence_matrix</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">oriented</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">toarray</span><span class="p">()</span>
<span class="n">n</span><span class="p">,</span><span class="n">m</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">shape</span>
<span class="n">numGuards</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">guardIdxs</span><span class="p">)</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">b</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">eps</span> <span class="o">=</span> <span class="mf">1e-1</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">numGuards</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">cp</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">numGuards</span><span class="p">)</span>
    <span class="n">constr</span> <span class="o">=</span> <span class="p">[</span><span class="n">A</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">nu</span> <span class="o">&gt;=</span> <span class="n">edgeVals</span><span class="o">*</span><span class="n">r</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span><span class="p">,</span> <span class="n">r</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">r</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">cp</span><span class="o">.</span><span class="n">Problem</span><span class="p">(</span><span class="n">cp</span><span class="o">.</span><span class="n">Minimize</span><span class="p">(</span><span class="n">nu</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">b</span><span class="o">/</span><span class="mi">100</span> <span class="o">+</span> <span class="n">r</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">w</span><span class="p">),</span><span class="n">constr</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nu</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">w</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="n">eps</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-----------------------------------------------------------------</span>
           <span class="n">OSQP</span> <span class="n">v0</span><span class="mf">.4.1</span>  <span class="o">-</span>  <span class="n">Operator</span> <span class="n">Splitting</span> <span class="n">QP</span> <span class="n">Solver</span>
              <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="n">Bartolomeo</span> <span class="n">Stellato</span><span class="p">,</span>  <span class="n">Goran</span> <span class="n">Banjac</span>
        <span class="n">University</span> <span class="n">of</span> <span class="n">Oxford</span>  <span class="o">-</span>  <span class="n">Stanford</span> <span class="n">University</span> <span class="mi">2018</span>
<span class="o">-----------------------------------------------------------------</span>
<span class="n">problem</span><span class="p">:</span>  <span class="n">variables</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">448</span><span class="p">,</span> <span class="n">constraints</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">1305</span>
          <span class="n">nnz</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">+</span> <span class="n">nnz</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">=</span> <span class="mi">27688</span>
<span class="n">settings</span><span class="p">:</span> <span class="n">linear</span> <span class="n">system</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">qdldl</span><span class="p">,</span>
          <span class="n">eps_abs</span> <span class="o">=</span> <span class="mf">1.0e-03</span><span class="p">,</span> <span class="n">eps_rel</span> <span class="o">=</span> <span class="mf">1.0e-03</span><span class="p">,</span>
          <span class="n">eps_prim_inf</span> <span class="o">=</span> <span class="mf">1.0e-04</span><span class="p">,</span> <span class="n">eps_dual_inf</span> <span class="o">=</span> <span class="mf">1.0e-04</span><span class="p">,</span>
          <span class="n">rho</span> <span class="o">=</span> <span class="mf">1.00e-01</span> <span class="p">(</span><span class="n">adaptive</span><span class="p">),</span>
          <span class="n">sigma</span> <span class="o">=</span> <span class="mf">1.00e-06</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.60</span><span class="p">,</span> <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">4000</span>
          <span class="n">check_termination</span><span class="p">:</span> <span class="n">on</span> <span class="p">(</span><span class="n">interval</span> <span class="mi">25</span><span class="p">),</span>
          <span class="n">scaling</span><span class="p">:</span> <span class="n">on</span><span class="p">,</span> <span class="n">scaled_termination</span><span class="p">:</span> <span class="n">off</span>
          <span class="n">warm</span> <span class="n">start</span><span class="p">:</span> <span class="n">on</span><span class="p">,</span> <span class="n">polish</span><span class="p">:</span> <span class="n">on</span>

<span class="nb">iter</span>   <span class="n">objective</span>    <span class="n">pri</span> <span class="n">res</span>    <span class="n">dua</span> <span class="n">res</span>    <span class="n">rho</span>        <span class="n">time</span>
   <span class="mi">1</span>  <span class="o">-</span><span class="mf">1.5225e-02</span>   <span class="mf">1.00e+01</span>   <span class="mf">1.24e+03</span>   <span class="mf">1.00e-01</span>   <span class="mf">1.50e-02</span><span class="n">s</span>
 <span class="mi">200</span>   <span class="mf">9.8653e+00</span>   <span class="mf">5.33e-03</span>   <span class="mf">1.96e-03</span>   <span class="mf">1.98e-02</span>   <span class="mf">1.10e-01</span><span class="n">s</span>

<span class="n">status</span><span class="p">:</span>               <span class="n">solved</span>
<span class="n">solution</span> <span class="n">polish</span><span class="p">:</span>      <span class="n">unsuccessful</span>
<span class="n">number</span> <span class="n">of</span> <span class="n">iterations</span><span class="p">:</span> <span class="mi">200</span>
<span class="n">optimal</span> <span class="n">objective</span><span class="p">:</span>    <span class="mf">9.8653</span>
<span class="n">run</span> <span class="n">time</span><span class="p">:</span>             <span class="mf">1.13e-01</span><span class="n">s</span>
<span class="n">optimal</span> <span class="n">rho</span> <span class="n">estimate</span><span class="p">:</span> <span class="mf">1.08e-02</span>

<span class="o">-----------------------------------------------------------------</span>
           <span class="n">OSQP</span> <span class="n">v0</span><span class="mf">.4.1</span>  <span class="o">-</span>  <span class="n">Operator</span> <span class="n">Splitting</span> <span class="n">QP</span> <span class="n">Solver</span>
              <span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="n">Bartolomeo</span> <span class="n">Stellato</span><span class="p">,</span>  <span class="n">Goran</span> <span class="n">Banjac</span>
        <span class="n">University</span> <span class="n">of</span> <span class="n">Oxford</span>  <span class="o">-</span>  <span class="n">Stanford</span> <span class="n">University</span> <span class="mi">2018</span>
<span class="o">-----------------------------------------------------------------</span>
<span class="n">problem</span><span class="p">:</span>  <span class="n">variables</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">448</span><span class="p">,</span> <span class="n">constraints</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">1305</span>
          <span class="n">nnz</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">+</span> <span class="n">nnz</span><span class="p">(</span><span class="n">A</span><span class="p">)</span> <span class="o">=</span> <span class="mi">27688</span>
<span class="n">settings</span><span class="p">:</span> <span class="n">linear</span> <span class="n">system</span> <span class="n">solver</span> <span class="o">=</span> <span class="n">qdldl</span><span class="p">,</span>
          <span class="n">eps_abs</span> <span class="o">=</span> <span class="mf">1.0e-03</span><span class="p">,</span> <span class="n">eps_rel</span> <span class="o">=</span> <span class="mf">1.0e-03</span><span class="p">,</span>
          <span class="n">eps_prim_inf</span> <span class="o">=</span> <span class="mf">1.0e-04</span><span class="p">,</span> <span class="n">eps_dual_inf</span> <span class="o">=</span> <span class="mf">1.0e-04</span><span class="p">,</span>
          <span class="n">rho</span> <span class="o">=</span> <span class="mf">1.00e-01</span> <span class="p">(</span><span class="n">adaptive</span><span class="p">),</span>
          <span class="n">sigma</span> <span class="o">=</span> <span class="mf">1.00e-06</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.60</span><span class="p">,</span> <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">4000</span>
          <span class="n">check_termination</span><span class="p">:</span> <span class="n">on</span> <span class="p">(</span><span class="n">interval</span> <span class="mi">25</span><span class="p">),</span>
          <span class="n">scaling</span><span class="p">:</span> <span class="n">on</span><span class="p">,</span> <span class="n">scaled_termination</span><span class="p">:</span> <span class="n">off</span>
          <span class="n">warm</span> <span class="n">start</span><span class="p">:</span> <span class="n">on</span><span class="p">,</span> <span class="n">polish</span><span class="p">:</span> <span class="n">on</span>

<span class="nb">iter</span>   <span class="n">objective</span>    <span class="n">pri</span> <span class="n">res</span>    <span class="n">dua</span> <span class="n">res</span>    <span class="n">rho</span>        <span class="n">time</span>
   <span class="mi">1</span>  <span class="o">-</span><span class="mf">5.7726e+02</span>   <span class="mf">1.00e+01</span>   <span class="mf">1.23e+04</span>   <span class="mf">1.00e-01</span>   <span class="mf">1.10e-02</span><span class="n">s</span>
 <span class="mi">200</span>   <span class="mf">1.8639e+01</span>   <span class="mf">1.36e-02</span>   <span class="mf">4.08e-01</span>   <span class="mf">1.00e-01</span>   <span class="mf">5.95e-02</span><span class="n">s</span>
 <span class="mi">400</span>   <span class="mf">1.9265e+01</span>   <span class="mf">2.46e-02</span>   <span class="mf">7.13e-02</span>   <span class="mf">1.92e-02</span>   <span class="mf">1.13e-01</span><span class="n">s</span>
 <span class="mi">600</span>   <span class="mf">1.8962e+01</span>   <span class="mf">1.23e-02</span>   <span class="mf">5.74e-02</span>   <span class="mf">1.92e-02</span>   <span class="mf">1.61e-01</span><span class="n">s</span>
 <span class="mi">800</span>   <span class="mf">1.8931e+01</span>   <span class="mf">7.97e-03</span>   <span class="mf">4.31e-02</span>   <span class="mf">1.92e-02</span>   <span class="mf">2.23e-01</span><span class="n">s</span>
<span class="mi">1000</span>   <span class="mf">1.8566e+01</span>   <span class="mf">6.39e-03</span>   <span class="mf">3.56e-02</span>   <span class="mf">1.92e-02</span>   <span class="mf">2.74e-01</span><span class="n">s</span>
<span class="mi">1200</span>   <span class="mf">1.8689e+01</span>   <span class="mf">8.31e-03</span>   <span class="mf">1.31e-02</span>   <span class="mf">1.92e-02</span>   <span class="mf">3.23e-01</span><span class="n">s</span>
<span class="mi">1225</span>   <span class="mf">1.8471e+01</span>   <span class="mf">7.94e-03</span>   <span class="mf">3.93e-03</span>   <span class="mf">1.92e-02</span>   <span class="mf">3.30e-01</span><span class="n">s</span>

<span class="n">status</span><span class="p">:</span>               <span class="n">solved</span>
<span class="n">solution</span> <span class="n">polish</span><span class="p">:</span>      <span class="n">unsuccessful</span>
<span class="n">number</span> <span class="n">of</span> <span class="n">iterations</span><span class="p">:</span> <span class="mi">1225</span>
<span class="n">optimal</span> <span class="n">objective</span><span class="p">:</span>    <span class="mf">18.4712</span>
<span class="n">run</span> <span class="n">time</span><span class="p">:</span>             <span class="mf">3.31e-01</span><span class="n">s</span>
<span class="n">optimal</span> <span class="n">rho</span> <span class="n">estimate</span><span class="p">:</span> <span class="mf">2.86e-02</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span> <span class="n">at</span> <span class="mh">0xd1b50d438</span><span class="o">&gt;</span><span class="p">]</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_30_1.png"><img alt="../../_images/interdiction_30_1.png" src="../../_images/interdiction_30_1.png" style="width: 373px; height: 250px;" /></a>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">edgeVals</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
<span class="n">edgeProbs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>

<span class="n">guards</span> <span class="o">=</span> <span class="p">[</span><span class="n">guardIdxs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">guardIdxs</span><span class="p">))</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">.5</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edgeProbs</span><span class="p">,</span><span class="n">visibleNodes</span><span class="o">=</span><span class="n">visibleNodes</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="n">Gnodes</span><span class="p">,</span><span class="n">Rnodes</span><span class="o">=</span><span class="n">Rnodes</span><span class="p">,</span><span class="n">guards</span><span class="o">=</span><span class="n">guards</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_31_0.png"><img alt="../../_images/interdiction_31_0.png" src="../../_images/interdiction_31_0.png" style="width: 438px; height: 360px;" /></a>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">optPath</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">edgeProbs</span><span class="p">)</span>
<span class="n">path_inds</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flatnonzero</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">.1</span><span class="p">))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">showPaths</span><span class="p">(</span><span class="n">G</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">edgeProbs</span><span class="p">,</span><span class="n">path</span><span class="o">=</span><span class="n">path_inds</span><span class="p">,</span><span class="n">visibleNodes</span><span class="o">=</span><span class="n">visibleNodes</span><span class="p">,</span><span class="n">Gnodes</span><span class="o">=</span><span class="n">Gnodes</span><span class="p">,</span><span class="n">Rnodes</span><span class="o">=</span><span class="n">Rnodes</span><span class="p">,</span><span class="n">guards</span><span class="o">=</span><span class="n">guards</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The evasion probability of the smuggler&#39;s optimal path is </span><span class="si">%e</span><span class="s2">.&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">c</span><span class="p">)),))</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">h</span> <span class="ow">in</span> <span class="n">buildings</span><span class="p">:</span>
    <span class="n">rect</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">w</span><span class="p">,</span><span class="n">h</span><span class="p">,</span><span class="n">fc</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">The</span> <span class="n">evasion</span> <span class="n">probability</span> <span class="n">of</span> <span class="n">the</span> <span class="n">smuggler</span><span class="s1">&#39;s optimal path is 9.213215e-05.</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../../_images/interdiction_32_1.png"><img alt="../../_images/interdiction_32_1.png" src="../../_images/interdiction_32_1.png" style="width: 438px; height: 360px;" /></a>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">CVXPY</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=cvxpy&repo=cvxpy&type=star&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/index.html">Install</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/index.html">User Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../api_reference/cvxpy.html">API Documentation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">FAQ</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../citing/index.html">Citing CVXPY</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Contributing</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../related_projects/index.html">Related Projects</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../updates/index.html">Changes to CVXPY</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../short_course/index.html">CVXPY Short Course</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../license/index.html">License</a></li>
</ul>


<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><div>
    <h3>
        Version selector
    </h3>
    <select id="dynamic_selector" name="versions" onchange="if (this.value) window.location.href=this.value">
    </select>
    <script>
        obj = $.getJSON("https://raw.githubusercontent.com/cvxpy/cvxpy/gh-pages/versions.json")
            .done(function (data) {
                const base_url = "https://www.cvxpy.org/"
                let html = "<option value='' selected>Choose version here</option>";
                html += "<option value=" + base_url + ">latest" + ""
                for (let i = 0; i < data.length; i++) {
                    html += "<option value=" + base_url + "version/"  + data[i] + ">" + data[i] + ""
                }
                document.getElementById("dynamic_selector").innerHTML = html;
            });
    </script>
</div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;The CVXPY authors.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/examples/applications/interdiction.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/cvxpy/cvxpy" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-50248335-1']);
      _gaq.push(['_setDomainName', 'none']);
      _gaq.push(['_setAllowLinker', true]);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
    
  </body>
</html>